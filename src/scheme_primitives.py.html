<html>
<head>
<title>scheme_primitives.py</title>
</head>

<body>
<h3>scheme_primitives.py (<a href="scheme_primitives.py">plain text</a>)</h3>
<hr>
<pre>
<span style="color: blue; font-weight: bold">from </span>operator <span style="color: blue; font-weight: bold">import </span><span style="font-weight: bold">*
</span><span style="color: blue; font-weight: bold">from </span>math <span style="color: blue; font-weight: bold">import </span>floor<span style="font-weight: bold">, </span>ceil
<span style="color: blue; font-weight: bold">from </span>scheme_utils <span style="color: blue; font-weight: bold">import </span><span style="font-weight: bold">*
</span><span style="color: blue; font-weight: bold">from </span>scheme_tokens <span style="color: blue; font-weight: bold">import </span>symbol_escaped
<span style="color: blue; font-weight: bold">from </span>io <span style="color: blue; font-weight: bold">import </span>StringIO
                              
<span style="color: blue; font-weight: bold">try</span><span style="font-weight: bold">:
    </span><span style="color: blue; font-weight: bold">import </span>turtle
<span style="color: blue; font-weight: bold">except</span><span style="font-weight: bold">:
    </span><span style="color: blue; font-weight: bold">print</span><span style="font-weight: bold">(</span><span style="color: red">"warning: could not import the turtle module."</span><span style="font-weight: bold">, </span>file<span style="font-weight: bold">=</span>sys<span style="font-weight: bold">.</span>stderr<span style="font-weight: bold">)

</span><span style="color: blue; font-weight: bold">class </span>SchemeValue<span style="font-weight: bold">:
    </span><span style="color: darkred">"""A value manipulated by a Scheme program."""

    </span><span style="color: blue; font-weight: bold">def </span>__bool__<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">):
        </span><span style="color: darkred">"""All Scheme values other than #f are considered true in Python as
        well as Scheme."""
        </span><span style="color: blue; font-weight: bold">return True

    def </span>type_name<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">):
        </span><span style="color: blue; font-weight: bold">return </span><span style="color: red">"scheme value"

    </span><span style="color: blue; font-weight: bold">def </span>__str__<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">):
        </span><span style="color: blue; font-weight: bold">return </span><span style="color: red">"&lt;{0}@{1}&gt;"</span><span style="font-weight: bold">.</span>format<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">.</span>type_name<span style="font-weight: bold">(), </span>hex<span style="font-weight: bold">(</span>id<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">)))

    </span><span style="color: blue; font-weight: bold">def </span>_repr_<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">):
        </span><span style="color: blue; font-weight: bold">return </span>str<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">)

    </span><span style="color: blue; font-weight: bold">def </span>write<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">, </span>out<span style="font-weight: bold">):
        </span><span style="color: darkred">"""Write a string representation of SELF on OUT, as for the write
        procedure in Scheme."""
        </span><span style="color: blue; font-weight: bold">print</span><span style="font-weight: bold">(</span>str<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">), </span>file<span style="font-weight: bold">=</span>out<span style="font-weight: bold">, </span>end<span style="font-weight: bold">=</span><span style="color: red">""</span><span style="font-weight: bold">)
        </span><span style="color: blue; font-weight: bold">return </span>UNSPEC

    <span style="color: blue; font-weight: bold">def </span>display<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">, </span>out<span style="font-weight: bold">):
        </span><span style="color: darkred">"""Write a string representation of SELF on OUT, without escapes,
        as for the display procedure in Scheme."""
        </span><span style="color: blue; font-weight: bold">return </span><span style="color: blue">self</span><span style="font-weight: bold">.</span>write<span style="font-weight: bold">(</span>out<span style="font-weight: bold">)

    </span><span style="color: blue; font-weight: bold">def </span>eqvp<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">, </span>other<span style="font-weight: bold">):
        </span><span style="color: blue; font-weight: bold">return </span>boolify<span style="font-weight: bold">(</span><span style="color: blue">self </span><span style="color: blue; font-weight: bold">is </span>other<span style="font-weight: bold">)

    </span><span style="color: blue; font-weight: bold">def </span>equalp<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">, </span>other<span style="font-weight: bold">):
        </span><span style="color: blue; font-weight: bold">return </span><span style="color: blue">self</span><span style="font-weight: bold">.</span>eqvp<span style="font-weight: bold">(</span>other<span style="font-weight: bold">)

    </span><span style="color: blue; font-weight: bold">def </span>atomp<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">):
        </span><span style="color: blue; font-weight: bold">return </span>TRUE

    <span style="color: blue; font-weight: bold">def </span>numberp<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">):
        </span><span style="color: blue; font-weight: bold">return </span>FALSE

    <span style="color: blue; font-weight: bold">def </span>integerp<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">):
        </span><span style="color: blue; font-weight: bold">return </span>FALSE

    <span style="color: blue; font-weight: bold">def </span>booleanp<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">):
        </span><span style="color: blue; font-weight: bold">return </span>FALSE

    <span style="color: blue; font-weight: bold">def </span>nullp<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">):
        </span><span style="color: blue; font-weight: bold">return </span>FALSE

    <span style="color: blue; font-weight: bold">def </span>pairp<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">):
        </span><span style="color: blue; font-weight: bold">return </span>FALSE

    <span style="color: blue; font-weight: bold">def </span>symbolp<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">):
        </span><span style="color: blue; font-weight: bold">return </span>FALSE

    <span style="color: blue; font-weight: bold">def </span>procedurep<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">):
        </span><span style="color: blue; font-weight: bold">return </span>FALSE

    <span style="color: blue; font-weight: bold">def </span>eof_objectp<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">):
        </span><span style="color: blue; font-weight: bold">return </span>FALSE

    <span style="color: blue; font-weight: bold">def </span>length<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">):
        </span><span style="color: darkred">"""The length of SELF as a Python integer, assuming SELF is a list."""
        </span><span style="color: blue; font-weight: bold">raise </span>SchemeError<span style="font-weight: bold">(</span><span style="color: red">"value has no length"</span><span style="font-weight: bold">)

    </span><span style="color: blue; font-weight: bold">def </span>nth<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">, </span>k<span style="font-weight: bold">):
        </span><span style="color: darkred">"""The Kth element of SELF, assuming it is a list."""
        </span><span style="color: blue; font-weight: bold">raise </span>SchemeError<span style="font-weight: bold">(</span><span style="color: red">"attempt to index a non-list"</span><span style="font-weight: bold">)

    </span><span style="color: blue; font-weight: bold">def </span>apply_step<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">, </span>args<span style="font-weight: bold">, </span>evaluation<span style="font-weight: bold">):
        </span><span style="color: darkred">"""Apply SELF to the arguments ARGS (a Python list of SchemeValues),
        modifying EVALUATION to contain either the resulting value, or
        the body of function and the environment in which it is to be
        evaluated."""
        </span><span style="color: blue; font-weight: bold">raise </span>SchemeError<span style="font-weight: bold">(</span><span style="color: red">"attempt to call something other than a function: {0}"
                          </span><span style="font-weight: bold">.</span>format<span style="font-weight: bold">(</span>repr<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">)))


</span><span style="color: blue; font-weight: bold">class </span>S_Expr<span style="font-weight: bold">(</span>SchemeValue<span style="font-weight: bold">):
    </span><span style="color: darkred">"""An S_Expr is a Scheme value that can be returned by the reader.
    Other Scheme values can only result from the evaluation of functions or
    forms (e.g., the values of lambda expressions)."""
    
</span><span style="color: blue; font-weight: bold">class </span>Pair<span style="font-weight: bold">(</span>S_Expr<span style="font-weight: bold">):
    </span><span style="color: blue; font-weight: bold">def </span>__init__<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">, </span>x<span style="font-weight: bold">, </span>y<span style="font-weight: bold">):
        </span><span style="color: blue">self</span><span style="font-weight: bold">.</span>car <span style="font-weight: bold">= </span>x
        <span style="color: blue">self</span><span style="font-weight: bold">.</span>cdr <span style="font-weight: bold">= </span>y

    <span style="color: blue; font-weight: bold">def </span>type_name<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">):
        </span><span style="color: blue; font-weight: bold">return </span><span style="color: red">"pair"

    </span><span style="color: blue; font-weight: bold">def </span>atomp<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">):
        </span><span style="color: blue; font-weight: bold">return </span>FALSE

    <span style="color: blue; font-weight: bold">def </span>pairp<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">):
        </span><span style="color: blue; font-weight: bold">return </span>TRUE

    <span style="color: blue; font-weight: bold">def </span>equalp<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">, </span>other<span style="font-weight: bold">):
        </span><span style="color: blue; font-weight: bold">if not </span>other<span style="font-weight: bold">.</span>pairp<span style="font-weight: bold">():
            </span><span style="color: blue; font-weight: bold">return </span>FALSE
        <span style="color: blue; font-weight: bold">return </span><span style="color: blue">self</span><span style="font-weight: bold">.</span>car<span style="font-weight: bold">.</span>equalp<span style="font-weight: bold">(</span>other<span style="font-weight: bold">.</span>car<span style="font-weight: bold">) </span><span style="color: blue; font-weight: bold">and </span><span style="color: blue">self</span><span style="font-weight: bold">.</span>cdr<span style="font-weight: bold">.</span>equalp<span style="font-weight: bold">(</span>other<span style="font-weight: bold">.</span>cdr<span style="font-weight: bold">)

    </span><span style="color: blue; font-weight: bold">def </span>__repr__<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">):
        </span><span style="color: blue; font-weight: bold">return </span><span style="color: red">"cons({0}, {1})"</span><span style="font-weight: bold">.</span>format<span style="font-weight: bold">(</span>repr<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">.</span>car<span style="font-weight: bold">), </span>repr<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">.</span>cdr<span style="font-weight: bold">))

    </span><span style="color: blue; font-weight: bold">def </span>__str__<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">):
        </span>out <span style="font-weight: bold">= </span>StringIO<span style="font-weight: bold">()
        </span><span style="color: blue">self</span><span style="font-weight: bold">.</span>display<span style="font-weight: bold">(</span>out<span style="font-weight: bold">)
        </span><span style="color: blue; font-weight: bold">return </span>out<span style="font-weight: bold">.</span>getvalue<span style="font-weight: bold">()

    </span><span style="color: blue; font-weight: bold">def </span>write<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">, </span>f<span style="font-weight: bold">):
        </span><span style="color: blue; font-weight: bold">print</span><span style="font-weight: bold">(</span><span style="color: red">"("</span><span style="font-weight: bold">, </span>file<span style="font-weight: bold">=</span>f<span style="font-weight: bold">, </span>end<span style="font-weight: bold">=</span><span style="color: red">""</span><span style="font-weight: bold">)             
        </span><span style="color: blue">self</span><span style="font-weight: bold">.</span>car<span style="font-weight: bold">.</span>write<span style="font-weight: bold">(</span>f<span style="font-weight: bold">)
        </span>p <span style="font-weight: bold">= </span><span style="color: blue">self</span><span style="font-weight: bold">.</span>cdr
        <span style="color: blue; font-weight: bold">while </span>p<span style="font-weight: bold">.</span>pairp<span style="font-weight: bold">():
            </span><span style="color: blue; font-weight: bold">print</span><span style="font-weight: bold">(</span><span style="color: red">" "</span><span style="font-weight: bold">, </span>file<span style="font-weight: bold">=</span>f<span style="font-weight: bold">, </span>end<span style="font-weight: bold">=</span><span style="color: red">""</span><span style="font-weight: bold">)
            </span>p<span style="font-weight: bold">.</span>car<span style="font-weight: bold">.</span>write<span style="font-weight: bold">(</span>f<span style="font-weight: bold">)
            </span>p <span style="font-weight: bold">= </span>p<span style="font-weight: bold">.</span>cdr
        <span style="color: blue; font-weight: bold">if not </span>p<span style="font-weight: bold">.</span>nullp<span style="font-weight: bold">():
            </span><span style="color: blue; font-weight: bold">print</span><span style="font-weight: bold">(</span><span style="color: red">" . "</span><span style="font-weight: bold">, </span>file<span style="font-weight: bold">=</span>f<span style="font-weight: bold">, </span>end<span style="font-weight: bold">=</span><span style="color: red">""</span><span style="font-weight: bold">)
            </span>p<span style="font-weight: bold">.</span>write<span style="font-weight: bold">(</span>f<span style="font-weight: bold">)
        </span><span style="color: blue; font-weight: bold">print</span><span style="font-weight: bold">(</span><span style="color: red">")"</span><span style="font-weight: bold">, </span>file<span style="font-weight: bold">=</span>f<span style="font-weight: bold">, </span>end<span style="font-weight: bold">=</span><span style="color: red">""</span><span style="font-weight: bold">)
        </span><span style="color: blue; font-weight: bold">return </span>UNSPEC

    <span style="color: blue; font-weight: bold">def </span>display<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">, </span>f<span style="font-weight: bold">):
        </span><span style="color: blue; font-weight: bold">print</span><span style="font-weight: bold">(</span><span style="color: red">"("</span><span style="font-weight: bold">, </span>file<span style="font-weight: bold">=</span>f<span style="font-weight: bold">, </span>end<span style="font-weight: bold">=</span><span style="color: red">""</span><span style="font-weight: bold">)             
        </span><span style="color: blue">self</span><span style="font-weight: bold">.</span>car<span style="font-weight: bold">.</span>display<span style="font-weight: bold">(</span>f<span style="font-weight: bold">)
        </span>p <span style="font-weight: bold">= </span><span style="color: blue">self</span><span style="font-weight: bold">.</span>cdr
        <span style="color: blue; font-weight: bold">while </span>p<span style="font-weight: bold">.</span>pairp<span style="font-weight: bold">():
            </span><span style="color: blue; font-weight: bold">print</span><span style="font-weight: bold">(</span><span style="color: red">" "</span><span style="font-weight: bold">, </span>file<span style="font-weight: bold">=</span>f<span style="font-weight: bold">, </span>end<span style="font-weight: bold">=</span><span style="color: red">""</span><span style="font-weight: bold">)
            </span>p<span style="font-weight: bold">.</span>car<span style="font-weight: bold">.</span>display<span style="font-weight: bold">(</span>f<span style="font-weight: bold">)
            </span>p <span style="font-weight: bold">= </span>p<span style="font-weight: bold">.</span>cdr
        <span style="color: blue; font-weight: bold">if not </span>p<span style="font-weight: bold">.</span>nullp<span style="font-weight: bold">():
            </span><span style="color: blue; font-weight: bold">print</span><span style="font-weight: bold">(</span><span style="color: red">" . "</span><span style="font-weight: bold">, </span>file<span style="font-weight: bold">=</span>f<span style="font-weight: bold">, </span>end<span style="font-weight: bold">=</span><span style="color: red">""</span><span style="font-weight: bold">)
            </span>p<span style="font-weight: bold">.</span>display<span style="font-weight: bold">(</span>f<span style="font-weight: bold">)
        </span><span style="color: blue; font-weight: bold">print</span><span style="font-weight: bold">(</span><span style="color: red">")"</span><span style="font-weight: bold">, </span>file<span style="font-weight: bold">=</span>f<span style="font-weight: bold">, </span>end<span style="font-weight: bold">=</span><span style="color: red">""</span><span style="font-weight: bold">)
        </span><span style="color: blue; font-weight: bold">return </span>UNSPEC

    <span style="color: blue; font-weight: bold">def </span>length<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">):
        </span>n <span style="font-weight: bold">= </span><span style="color: red">0
        </span><span style="color: blue; font-weight: bold">while </span><span style="color: blue">self</span><span style="font-weight: bold">.</span>pairp<span style="font-weight: bold">():
            </span>n <span style="font-weight: bold">+= </span><span style="color: red">1
            </span><span style="color: blue">self </span><span style="font-weight: bold">= </span><span style="color: blue">self</span><span style="font-weight: bold">.</span>cdr
        <span style="color: blue; font-weight: bold">if not </span><span style="color: blue">self</span><span style="font-weight: bold">.</span>nullp<span style="font-weight: bold">():
            </span><span style="color: blue; font-weight: bold">raise </span>SchemeError<span style="font-weight: bold">(</span><span style="color: red">"length attempted on improper list"</span><span style="font-weight: bold">)
        </span><span style="color: blue; font-weight: bold">return </span>n

    <span style="color: blue; font-weight: bold">def </span>nth<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">, </span>k<span style="font-weight: bold">):
        </span>x <span style="font-weight: bold">= </span><span style="color: blue">self
        </span><span style="color: blue; font-weight: bold">if </span>k <span style="font-weight: bold">&lt; </span><span style="color: red">0</span><span style="font-weight: bold">:
            </span><span style="color: blue; font-weight: bold">raise </span>SchemeError<span style="font-weight: bold">(</span><span style="color: red">"negative index into list"</span><span style="font-weight: bold">)
        </span><span style="color: blue; font-weight: bold">while True</span><span style="font-weight: bold">:
            </span><span style="color: blue; font-weight: bold">if </span>x<span style="font-weight: bold">.</span>nullp<span style="font-weight: bold">():
                </span><span style="color: blue; font-weight: bold">raise </span>SchemeError<span style="font-weight: bold">(</span><span style="color: red">"list index out of bounds"</span><span style="font-weight: bold">)
            </span><span style="color: blue; font-weight: bold">elif not </span>x<span style="font-weight: bold">.</span>pairp<span style="font-weight: bold">():
                </span><span style="color: blue; font-weight: bold">raise </span>SchemeError<span style="font-weight: bold">(</span><span style="color: red">"ill-formed list"</span><span style="font-weight: bold">)
            </span><span style="color: blue; font-weight: bold">if </span>k <span style="font-weight: bold">== </span><span style="color: red">0</span><span style="font-weight: bold">:
                </span><span style="color: blue; font-weight: bold">return </span>x<span style="font-weight: bold">.</span>car
            x <span style="font-weight: bold">= </span>x<span style="font-weight: bold">.</span>cdr
            k <span style="font-weight: bold">-= </span><span style="color: red">1
            
</span><span style="color: blue; font-weight: bold">class </span>Null<span style="font-weight: bold">(</span>S_Expr<span style="font-weight: bold">):
    </span><span style="color: blue; font-weight: bold">def </span>__str__<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">):
        </span><span style="color: blue; font-weight: bold">return </span><span style="color: red">"()"

    </span><span style="color: blue; font-weight: bold">def </span>type_name<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">):
        </span><span style="color: blue; font-weight: bold">return </span><span style="color: red">"null"

    </span><span style="color: blue; font-weight: bold">def </span>nullp<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">):
        </span><span style="color: blue; font-weight: bold">return </span>TRUE

    <span style="color: blue; font-weight: bold">def </span>atomp<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">):
        </span><span style="color: blue; font-weight: bold">return </span>TRUE

    <span style="color: blue; font-weight: bold">def </span>length<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">):
        </span><span style="color: blue; font-weight: bold">return </span><span style="color: red">0

</span>NULL <span style="font-weight: bold">= </span>Null<span style="font-weight: bold">()

</span><span style="color: blue; font-weight: bold">class </span>Bool<span style="font-weight: bold">(</span>S_Expr<span style="font-weight: bold">):
    </span><span style="color: darkred">"""A boolean Scheme value (#t or #f).  For convenience, this class is defined
    so that TRUE (#t) is a true Python value as well and FALSE is a false
    Python value."""

    </span><span style="color: blue; font-weight: bold">def </span>__init__<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">, </span>is_true<span style="font-weight: bold">):
        </span><span style="color: blue">self</span><span style="font-weight: bold">.</span>__truth <span style="font-weight: bold">= </span>bool<span style="font-weight: bold">(</span>is_true<span style="font-weight: bold">)

    </span><span style="color: blue; font-weight: bold">def </span>__bool__<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">):
        </span><span style="color: darkred">"""As a Python value, SELF is True if it is #t and False otherwise."""
        </span><span style="color: blue; font-weight: bold">return </span><span style="color: blue">self</span><span style="font-weight: bold">.</span>__truth

    <span style="color: blue; font-weight: bold">def </span>__str__<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">):
        </span><span style="color: blue; font-weight: bold">return </span><span style="color: red">"#t" </span><span style="color: blue; font-weight: bold">if </span><span style="color: blue">self </span><span style="color: blue; font-weight: bold">else </span><span style="color: red">"#f"

    </span><span style="color: blue; font-weight: bold">def </span>type_name<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">):
        </span><span style="color: blue; font-weight: bold">return </span><span style="color: red">"boolean"

    </span><span style="color: blue; font-weight: bold">def </span>atomp<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">):
        </span><span style="color: blue; font-weight: bold">return </span>TRUE

    <span style="color: blue; font-weight: bold">def </span>booleanp<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">):
        </span><span style="color: blue; font-weight: bold">return </span>TRUE

TRUE  <span style="font-weight: bold">= </span>Bool<span style="font-weight: bold">(</span><span style="color: blue; font-weight: bold">True</span><span style="font-weight: bold">)
</span>FALSE <span style="font-weight: bold">= </span>Bool<span style="font-weight: bold">(</span><span style="color: blue; font-weight: bold">False</span><span style="font-weight: bold">)

</span><span style="color: blue; font-weight: bold">class </span>Number<span style="font-weight: bold">(</span>S_Expr<span style="font-weight: bold">):
    </span><span style="color: blue; font-weight: bold">def </span>__init__<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">, </span>val<span style="font-weight: bold">):
        </span><span style="color: blue">self</span><span style="font-weight: bold">.</span>num_val <span style="font-weight: bold">= </span>val

    <span style="color: blue; font-weight: bold">def </span>type_name<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">):
        </span><span style="color: blue; font-weight: bold">return </span><span style="color: red">"integer" </span><span style="color: blue; font-weight: bold">if </span>type<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">.</span>num_val <span style="color: blue; font-weight: bold">is </span>int<span style="font-weight: bold">) </span><span style="color: blue; font-weight: bold">else </span><span style="color: red">"real"

    </span><span style="color: blue; font-weight: bold">def </span>atomp<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">):
        </span><span style="color: blue; font-weight: bold">return </span>TRUE

    <span style="color: blue; font-weight: bold">def </span>numberp<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">):
        </span><span style="color: blue; font-weight: bold">return </span>TRUE

    <span style="color: blue; font-weight: bold">def </span>integerp<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">):
        </span><span style="color: blue; font-weight: bold">return </span>boolify<span style="font-weight: bold">(</span>type<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">.</span>num_val<span style="font-weight: bold">) </span><span style="color: blue; font-weight: bold">is </span>int<span style="font-weight: bold">)

    </span><span style="color: blue; font-weight: bold">def </span>write<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">, </span>f<span style="font-weight: bold">):
        </span><span style="color: blue; font-weight: bold">print</span><span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">.</span>num_val<span style="font-weight: bold">, </span>file<span style="font-weight: bold">=</span>f<span style="font-weight: bold">, </span>end<span style="font-weight: bold">=</span><span style="color: red">""</span><span style="font-weight: bold">)
    
    </span><span style="color: blue; font-weight: bold">def </span>eqvp<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">, </span>other<span style="font-weight: bold">):
        </span><span style="color: blue; font-weight: bold">return </span>boolify<span style="font-weight: bold">(</span>other<span style="font-weight: bold">.</span>integerp<span style="font-weight: bold">() </span><span style="color: blue; font-weight: bold">and </span><span style="color: blue">self</span><span style="font-weight: bold">.</span>num_val <span style="font-weight: bold">== </span>other<span style="font-weight: bold">.</span>num_val<span style="font-weight: bold">)

    </span><span style="color: blue; font-weight: bold">def </span>__str__<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">):
        </span><span style="color: blue; font-weight: bold">return </span>str<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">.</span>num_val<span style="font-weight: bold">)

</span><span style="color: blue; font-weight: bold">class </span>Symbol<span style="font-weight: bold">(</span>S_Expr<span style="font-weight: bold">):
    </span><span style="color: blue; font-weight: bold">def </span>__init__<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">, </span>ident<span style="font-weight: bold">):
        </span><span style="color: blue">self</span><span style="font-weight: bold">.</span>ident <span style="font-weight: bold">= </span>ident
        <span style="color: blue">self</span><span style="font-weight: bold">.</span>escaped <span style="font-weight: bold">= </span>symbol_escaped<span style="font-weight: bold">(</span>ident<span style="font-weight: bold">)

    </span><span style="color: blue; font-weight: bold">def </span>type_name<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">):
        </span><span style="color: blue; font-weight: bold">return </span><span style="color: red">"symbol"

    </span><span style="color: blue; font-weight: bold">def </span>__str__<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">):
        </span><span style="color: blue; font-weight: bold">return </span><span style="color: blue">self</span><span style="font-weight: bold">.</span>ident

    <span style="color: blue; font-weight: bold">def </span>__repr__<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">):
        </span><span style="color: blue; font-weight: bold">return </span><span style="color: red">"Symbol({0})"</span><span style="font-weight: bold">.</span>format<span style="font-weight: bold">(</span>repr<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">.</span>ident<span style="font-weight: bold">))

    </span><span style="color: blue; font-weight: bold">def </span>__hash__<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">):
        </span><span style="color: blue; font-weight: bold">return </span>hash<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">.</span>ident<span style="font-weight: bold">)

    </span>@staticmethod
    <span style="color: blue; font-weight: bold">def </span>string_to_symbol<span style="font-weight: bold">(</span>name<span style="font-weight: bold">):
        </span><span style="color: darkred">"""The Symbol whose string value is NAME.  Always returns the same
        Symbol object when given the same string."""
        </span>result <span style="font-weight: bold">= </span>Symbol<span style="font-weight: bold">.</span>symbols<span style="font-weight: bold">.</span>get<span style="font-weight: bold">(</span>name<span style="font-weight: bold">, </span><span style="color: blue">None</span><span style="font-weight: bold">)
        </span><span style="color: blue; font-weight: bold">if </span>result <span style="color: blue; font-weight: bold">is </span><span style="color: blue">None</span><span style="font-weight: bold">:
            </span>result <span style="font-weight: bold">= </span>Symbol<span style="font-weight: bold">.</span>symbols<span style="font-weight: bold">[</span>name<span style="font-weight: bold">] = </span>Symbol<span style="font-weight: bold">(</span>name<span style="font-weight: bold">)
        </span><span style="color: blue; font-weight: bold">return </span>result

    <span style="color: blue; font-weight: bold">def </span>atomp<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">):
        </span><span style="color: blue; font-weight: bold">return </span>TRUE

    <span style="color: blue; font-weight: bold">def </span>symbolp<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">):
        </span><span style="color: blue; font-weight: bold">return </span>TRUE

    <span style="color: blue; font-weight: bold">def </span>write<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">, </span>f<span style="font-weight: bold">):
        </span><span style="color: blue; font-weight: bold">print</span><span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">.</span>escaped<span style="font-weight: bold">, </span>file<span style="font-weight: bold">=</span>f<span style="font-weight: bold">, </span>end<span style="font-weight: bold">=</span><span style="color: red">""</span><span style="font-weight: bold">)
    
    </span><span style="color: blue; font-weight: bold">def </span>display<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">, </span>f<span style="font-weight: bold">):
        </span><span style="color: blue; font-weight: bold">print</span><span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">.</span>ident<span style="font-weight: bold">, </span>file<span style="font-weight: bold">=</span>f<span style="font-weight: bold">, </span>end<span style="font-weight: bold">=</span><span style="color: red">""</span><span style="font-weight: bold">)

    </span><span style="color: green; font-style: italic"># The mapping of names to symbols.
    </span>symbols <span style="font-weight: bold">= {}

</span><span style="color: blue; font-weight: bold">class </span>Unspecified<span style="font-weight: bold">(</span>SchemeValue<span style="font-weight: bold">):
    </span><span style="color: darkred">"""A class whose sole instance is the "unspecified value", which is 
    returned to represent the value of a Scheme expressions whose value
    is irrelevant and not specified by the Scheme report."""
    </span><span style="color: blue; font-weight: bold">def </span>type_name<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">):
        </span><span style="color: blue; font-weight: bold">return </span><span style="color: red">"unspecified value"

</span>UNSPEC <span style="font-weight: bold">= </span>Unspecified<span style="font-weight: bold">()

</span><span style="color: blue; font-weight: bold">class </span>Eof<span style="font-weight: bold">(</span>SchemeValue<span style="font-weight: bold">):
    </span><span style="color: darkred">"""A class whose sole instance is the "end-of-file object", which is 
    returned to represent an end-of-file condition when reading."""
    </span><span style="color: blue; font-weight: bold">def </span>type_name<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">):
        </span><span style="color: blue; font-weight: bold">return </span><span style="color: red">"eof object"

    </span><span style="color: blue; font-weight: bold">def </span>eof_objectp<span style="font-weight: bold">(</span><span style="color: blue">self</span><span style="font-weight: bold">):
        </span><span style="color: blue; font-weight: bold">return </span>TRUE

THE_EOF_OBJECT <span style="font-weight: bold">= </span>Eof<span style="font-weight: bold">()

</span><span style="color: blue; font-weight: bold">def </span>check_type<span style="font-weight: bold">(</span>val<span style="font-weight: bold">, </span>predicate<span style="font-weight: bold">, </span>k<span style="font-weight: bold">, </span>name<span style="font-weight: bold">):
    </span><span style="color: darkred">"""Returns VAL.  Raises a SchemeError if not PREDICATE(VAL), using
    "argument K of NAME" to describe the offending value in any error message."""
    </span><span style="color: blue; font-weight: bold">if not </span>predicate<span style="font-weight: bold">(</span>val<span style="font-weight: bold">):
        </span><span style="color: blue; font-weight: bold">raise </span>SchemeError<span style="font-weight: bold">(</span><span style="color: red">"argument {0} of {1} has wrong type ({2})"
                          </span><span style="font-weight: bold">.</span>format<span style="font-weight: bold">(</span>k<span style="font-weight: bold">, </span>name<span style="font-weight: bold">, </span>val<span style="font-weight: bold">.</span>type_name<span style="font-weight: bold">()))
    </span><span style="color: blue; font-weight: bold">return </span>val

<span style="color: blue; font-weight: bold">def </span>string_to_atom<span style="font-weight: bold">(</span>s<span style="font-weight: bold">):
    </span><span style="color: darkred">"""The number or symbol denoted by S."""
    </span><span style="color: blue; font-weight: bold">try</span><span style="font-weight: bold">:
        </span><span style="color: blue; font-weight: bold">return </span>Number<span style="font-weight: bold">(</span>int<span style="font-weight: bold">(</span>s<span style="font-weight: bold">))
    </span><span style="color: blue; font-weight: bold">except</span><span style="font-weight: bold">:
        </span><span style="color: blue; font-weight: bold">pass
    try</span><span style="font-weight: bold">:
        </span><span style="color: blue; font-weight: bold">return </span>Number<span style="font-weight: bold">(</span>float<span style="font-weight: bold">(</span>s<span style="font-weight: bold">))
    </span><span style="color: blue; font-weight: bold">except</span><span style="font-weight: bold">:
        </span><span style="color: blue; font-weight: bold">pass
    return </span>Symbol<span style="font-weight: bold">.</span>string_to_symbol<span style="font-weight: bold">(</span>s<span style="font-weight: bold">)

</span><span style="color: green; font-style: italic">##
## Boolean operations 
##

</span><span style="color: blue; font-weight: bold">def </span>scm_booleanp<span style="font-weight: bold">(</span>x<span style="font-weight: bold">):
    </span><span style="color: blue; font-weight: bold">return </span>x<span style="font-weight: bold">.</span>booleanp<span style="font-weight: bold">()

</span><span style="color: blue; font-weight: bold">def </span>scm_not<span style="font-weight: bold">(</span>x<span style="font-weight: bold">):
    </span><span style="color: blue; font-weight: bold">return </span>boolify<span style="font-weight: bold">(</span><span style="color: blue; font-weight: bold">not </span>x<span style="font-weight: bold">)

</span><span style="color: blue; font-weight: bold">def </span>boolify<span style="font-weight: bold">(</span>x<span style="font-weight: bold">):
    </span><span style="color: darkred">"""Return the Scheme boolean value that corresponds to the "truthfulness"
    of X in Python."""
    </span><span style="color: blue; font-weight: bold">return </span>TRUE <span style="color: blue; font-weight: bold">if </span>x <span style="color: blue; font-weight: bold">else </span>FALSE

<span style="color: green; font-style: italic">##
## Equivalence operations
##

</span><span style="color: blue; font-weight: bold">def </span>scm_eqp<span style="font-weight: bold">(</span>x<span style="font-weight: bold">, </span>y<span style="font-weight: bold">):
    </span><span style="color: blue; font-weight: bold">return </span>boolify<span style="font-weight: bold">(</span>x <span style="color: blue; font-weight: bold">is </span>y<span style="font-weight: bold">)

</span><span style="color: blue; font-weight: bold">def </span>scm_eqvp<span style="font-weight: bold">(</span>x<span style="font-weight: bold">, </span>y<span style="font-weight: bold">):
    </span><span style="color: blue; font-weight: bold">return </span>x<span style="font-weight: bold">.</span>eqvp<span style="font-weight: bold">(</span>y<span style="font-weight: bold">)

</span><span style="color: blue; font-weight: bold">def </span>scm_equalp<span style="font-weight: bold">(</span>x<span style="font-weight: bold">, </span>y<span style="font-weight: bold">):
    </span><span style="color: blue; font-weight: bold">return </span>x<span style="font-weight: bold">.</span>equalp<span style="font-weight: bold">(</span>y<span style="font-weight: bold">)

</span><span style="color: green; font-style: italic">##
## Operations on lists and pairs.
##

</span><span style="color: blue; font-weight: bold">def </span>scm_pairp<span style="font-weight: bold">(</span>x<span style="font-weight: bold">):
    </span><span style="color: blue; font-weight: bold">return </span>x<span style="font-weight: bold">.</span>pairp<span style="font-weight: bold">()

</span><span style="color: blue; font-weight: bold">def </span>scm_nullp<span style="font-weight: bold">(</span>x<span style="font-weight: bold">):
    </span><span style="color: blue; font-weight: bold">return </span>x<span style="font-weight: bold">.</span>nullp<span style="font-weight: bold">()

</span><span style="color: blue; font-weight: bold">def </span>scm_listp<span style="font-weight: bold">(</span>x<span style="font-weight: bold">):
    </span>p1 <span style="font-weight: bold">= </span>x
    <span style="color: blue; font-weight: bold">while not </span>x<span style="font-weight: bold">.</span>nullp<span style="font-weight: bold">():
        </span><span style="color: blue; font-weight: bold">if not </span>x<span style="font-weight: bold">.</span>pairp<span style="font-weight: bold">():
            </span><span style="color: blue; font-weight: bold">return </span>FALSE
        <span style="color: blue; font-weight: bold">if </span>x<span style="font-weight: bold">.</span>cdr<span style="font-weight: bold">.</span>nullp<span style="font-weight: bold">():
            </span><span style="color: blue; font-weight: bold">return </span>TRUE
        <span style="color: blue; font-weight: bold">if not </span>x<span style="font-weight: bold">.</span>cdr<span style="font-weight: bold">.</span>pairp<span style="font-weight: bold">():
            </span><span style="color: blue; font-weight: bold">return </span>FALSE
        <span style="color: blue; font-weight: bold">if </span>p1 <span style="color: blue; font-weight: bold">is </span>x<span style="font-weight: bold">.</span>cdr <span style="color: blue; font-weight: bold">or </span>p1 <span style="color: blue; font-weight: bold">is </span>x<span style="font-weight: bold">.</span>cdr<span style="font-weight: bold">.</span>cdr<span style="font-weight: bold">:
            </span><span style="color: blue; font-weight: bold">return </span>FALSE
        p1 <span style="font-weight: bold">= </span>x<span style="font-weight: bold">.</span>cdr
        x <span style="font-weight: bold">= </span>p1<span style="font-weight: bold">.</span>cdr
    <span style="color: blue; font-weight: bold">return </span>TRUE

<span style="color: blue; font-weight: bold">def </span>scm_length<span style="font-weight: bold">(</span>x<span style="font-weight: bold">):
    </span>check_type<span style="font-weight: bold">(</span>x<span style="font-weight: bold">, </span>scm_listp<span style="font-weight: bold">, </span><span style="color: red">0</span><span style="font-weight: bold">, </span><span style="color: red">'length'</span><span style="font-weight: bold">)
    </span><span style="color: blue; font-weight: bold">return </span>Number<span style="font-weight: bold">(</span>x<span style="font-weight: bold">.</span>length<span style="font-weight: bold">())

</span><span style="color: blue; font-weight: bold">def </span>scm_cons<span style="font-weight: bold">(</span>x<span style="font-weight: bold">, </span>y<span style="font-weight: bold">):
    </span><span style="color: blue; font-weight: bold">return </span>Pair<span style="font-weight: bold">(</span>x<span style="font-weight: bold">, </span>y<span style="font-weight: bold">)

</span><span style="color: blue; font-weight: bold">def </span>scm_car<span style="font-weight: bold">(</span>x<span style="font-weight: bold">):
    </span>check_type<span style="font-weight: bold">(</span>x<span style="font-weight: bold">, </span>scm_pairp<span style="font-weight: bold">, </span><span style="color: red">0</span><span style="font-weight: bold">, </span><span style="color: red">'car'</span><span style="font-weight: bold">)
    </span><span style="color: blue; font-weight: bold">return </span>x<span style="font-weight: bold">.</span>car

<span style="color: blue; font-weight: bold">def </span>scm_cdr<span style="font-weight: bold">(</span>x<span style="font-weight: bold">):
    </span>check_type<span style="font-weight: bold">(</span>x<span style="font-weight: bold">, </span>scm_pairp<span style="font-weight: bold">, </span><span style="color: red">0</span><span style="font-weight: bold">, </span><span style="color: red">'cdr'</span><span style="font-weight: bold">)
    </span><span style="color: blue; font-weight: bold">return </span>x<span style="font-weight: bold">.</span>cdr

<span style="color: blue; font-weight: bold">def </span>scm_set_car<span style="font-weight: bold">(</span>x<span style="font-weight: bold">, </span>y<span style="font-weight: bold">):
    </span>check_type<span style="font-weight: bold">(</span>x<span style="font-weight: bold">, </span>scm_pairp<span style="font-weight: bold">, </span><span style="color: red">0</span><span style="font-weight: bold">, </span><span style="color: red">"set-car"</span><span style="font-weight: bold">)
    </span>x<span style="font-weight: bold">.</span>car <span style="font-weight: bold">= </span>y
    <span style="color: blue; font-weight: bold">return </span>UNSPEC

<span style="color: blue; font-weight: bold">def </span>scm_set_cdr<span style="font-weight: bold">(</span>x<span style="font-weight: bold">, </span>y<span style="font-weight: bold">):
    </span>check_type<span style="font-weight: bold">(</span>x<span style="font-weight: bold">, </span>scm_pairp<span style="font-weight: bold">, </span><span style="color: red">0</span><span style="font-weight: bold">, </span><span style="color: red">"set-cdr"</span><span style="font-weight: bold">)
    </span>x<span style="font-weight: bold">.</span>cdr <span style="font-weight: bold">= </span>y
    <span style="color: blue; font-weight: bold">return </span>UNSPEC

<span style="color: blue; font-weight: bold">def </span>scm_list<span style="font-weight: bold">(*</span>members<span style="font-weight: bold">):
    </span>result <span style="font-weight: bold">= </span>NULL
    <span style="color: blue; font-weight: bold">for </span>i <span style="color: blue; font-weight: bold">in </span>range<span style="font-weight: bold">(</span>len<span style="font-weight: bold">(</span>members<span style="font-weight: bold">)-</span><span style="color: red">1</span><span style="font-weight: bold">, -</span><span style="color: red">1</span><span style="font-weight: bold">, -</span><span style="color: red">1</span><span style="font-weight: bold">):
        </span>result <span style="font-weight: bold">= </span>scm_cons<span style="font-weight: bold">(</span>members<span style="font-weight: bold">[</span>i<span style="font-weight: bold">], </span>result<span style="font-weight: bold">)
    </span><span style="color: blue; font-weight: bold">return </span>result

<span style="color: blue; font-weight: bold">def </span>scm_append<span style="font-weight: bold">(*</span>vals<span style="font-weight: bold">):
    </span><span style="color: blue; font-weight: bold">if </span>len<span style="font-weight: bold">(</span>vals<span style="font-weight: bold">) == </span><span style="color: red">0</span><span style="font-weight: bold">:
        </span><span style="color: blue; font-weight: bold">return </span>NULL
    result <span style="font-weight: bold">= </span>vals<span style="font-weight: bold">[-</span><span style="color: red">1</span><span style="font-weight: bold">]
    </span><span style="color: blue; font-weight: bold">for </span>i <span style="color: blue; font-weight: bold">in </span>range<span style="font-weight: bold">(</span>len<span style="font-weight: bold">(</span>vals<span style="font-weight: bold">)-</span><span style="color: red">2</span><span style="font-weight: bold">, -</span><span style="color: red">1</span><span style="font-weight: bold">, -</span><span style="color: red">1</span><span style="font-weight: bold">):
        </span>v <span style="font-weight: bold">= </span>vals<span style="font-weight: bold">[</span>i<span style="font-weight: bold">]
        </span>check_type<span style="font-weight: bold">(</span>v<span style="font-weight: bold">, </span>scm_listp<span style="font-weight: bold">, </span>i<span style="font-weight: bold">, </span><span style="color: red">"append"</span><span style="font-weight: bold">)
        </span><span style="color: blue; font-weight: bold">if not </span>v<span style="font-weight: bold">.</span>nullp<span style="font-weight: bold">():
            </span>r <span style="font-weight: bold">= </span>p <span style="font-weight: bold">= </span>scm_cons<span style="font-weight: bold">(</span>v<span style="font-weight: bold">.</span>car<span style="font-weight: bold">, </span>result<span style="font-weight: bold">)
            </span>v <span style="font-weight: bold">= </span>v<span style="font-weight: bold">.</span>cdr
            <span style="color: blue; font-weight: bold">while </span>v<span style="font-weight: bold">.</span>pairp<span style="font-weight: bold">():
                </span>p<span style="font-weight: bold">.</span>cdr <span style="font-weight: bold">= </span>scm_cons<span style="font-weight: bold">(</span>v<span style="font-weight: bold">.</span>car<span style="font-weight: bold">, </span>result<span style="font-weight: bold">)
                </span>p <span style="font-weight: bold">= </span>p<span style="font-weight: bold">.</span>cdr
                v <span style="font-weight: bold">= </span>v<span style="font-weight: bold">.</span>cdr
            result <span style="font-weight: bold">= </span>r
    <span style="color: blue; font-weight: bold">return </span>result

<span style="color: green; font-style: italic">##
## Operations on symbols
##

</span><span style="color: blue; font-weight: bold">def </span>scm_symbolp<span style="font-weight: bold">(</span>x<span style="font-weight: bold">):
    </span><span style="color: blue; font-weight: bold">return </span>x<span style="font-weight: bold">.</span>symbolp<span style="font-weight: bold">()

</span><span style="color: green; font-style: italic">##
## Operations on integers
##

</span><span style="color: blue; font-weight: bold">def </span>scm_numberp<span style="font-weight: bold">(</span>x<span style="font-weight: bold">):
    </span><span style="color: blue; font-weight: bold">return </span>x<span style="font-weight: bold">.</span>numberp<span style="font-weight: bold">()

</span><span style="color: blue; font-weight: bold">def </span>scm_integerp<span style="font-weight: bold">(</span>x<span style="font-weight: bold">):
    </span><span style="color: blue; font-weight: bold">return </span>x<span style="font-weight: bold">.</span>integerp<span style="font-weight: bold">()

</span><span style="color: blue; font-weight: bold">def </span>_check_nums<span style="font-weight: bold">(*</span>vals<span style="font-weight: bold">, </span>pred <span style="font-weight: bold">= </span>scm_numberp<span style="font-weight: bold">):
    </span><span style="color: darkred">"""Check that all arguments in VALS satisfy PRED. TYPE_NAME is used
    for error messages."""
    </span><span style="color: blue; font-weight: bold">for </span>i <span style="color: blue; font-weight: bold">in </span>range<span style="font-weight: bold">(</span>len<span style="font-weight: bold">(</span>vals<span style="font-weight: bold">)):
        </span><span style="color: blue; font-weight: bold">if not </span>vals<span style="font-weight: bold">[</span>i<span style="font-weight: bold">].</span>numberp<span style="font-weight: bold">():
            </span>msg <span style="font-weight: bold">= </span><span style="color: red">"an integer" </span><span style="color: blue; font-weight: bold">if </span>pred <span style="color: blue; font-weight: bold">is </span>scm_integerp <span style="color: blue; font-weight: bold">else </span><span style="color: red">"a number"
            </span><span style="color: blue; font-weight: bold">raise </span>SchemeError<span style="font-weight: bold">(</span><span style="color: red">"operand {0} is not {1}."</span><span style="font-weight: bold">.</span>format<span style="font-weight: bold">(</span>i<span style="font-weight: bold">, </span>msg<span style="font-weight: bold">))

</span><span style="color: blue; font-weight: bold">def </span>_arith<span style="font-weight: bold">(</span>op<span style="font-weight: bold">, </span>init<span style="font-weight: bold">, </span>vals<span style="font-weight: bold">):
    </span><span style="color: darkred">"""Perform the OP operation on the integer values of VALS, with INIT as
    the value when VALS is empty. Returns the result as a Scheme value."""
    </span>_check_nums<span style="font-weight: bold">(*</span>vals<span style="font-weight: bold">)
    </span>s <span style="font-weight: bold">= </span>init
    <span style="color: blue; font-weight: bold">for </span>i <span style="color: blue; font-weight: bold">in </span>range<span style="font-weight: bold">(</span>len<span style="font-weight: bold">(</span>vals<span style="font-weight: bold">)):
        </span>s <span style="font-weight: bold">= </span>op<span style="font-weight: bold">(</span>s<span style="font-weight: bold">, </span>vals<span style="font-weight: bold">[</span>i<span style="font-weight: bold">].</span>num_val<span style="font-weight: bold">)
    </span><span style="color: blue; font-weight: bold">return </span>Number<span style="font-weight: bold">(</span>s<span style="font-weight: bold">)

</span><span style="color: blue; font-weight: bold">def </span>scm_add<span style="font-weight: bold">(*</span>vals<span style="font-weight: bold">):
    </span><span style="color: blue; font-weight: bold">return </span>_arith<span style="font-weight: bold">(</span>add<span style="font-weight: bold">, </span><span style="color: red">0</span><span style="font-weight: bold">, </span>vals<span style="font-weight: bold">)

</span><span style="color: blue; font-weight: bold">def </span>scm_sub<span style="font-weight: bold">(</span>val0<span style="font-weight: bold">, *</span>vals<span style="font-weight: bold">):
    </span><span style="color: blue; font-weight: bold">if </span>len<span style="font-weight: bold">(</span>vals<span style="font-weight: bold">) == </span><span style="color: red">0</span><span style="font-weight: bold">:
        </span><span style="color: blue; font-weight: bold">return </span>Number<span style="font-weight: bold">(-</span>val0<span style="font-weight: bold">.</span>num_val<span style="font-weight: bold">)
    </span><span style="color: blue; font-weight: bold">return </span>_arith<span style="font-weight: bold">(</span>sub<span style="font-weight: bold">, </span>val0<span style="font-weight: bold">.</span>num_val<span style="font-weight: bold">, </span>vals<span style="font-weight: bold">)

</span><span style="color: blue; font-weight: bold">def </span>scm_mul<span style="font-weight: bold">(*</span>vals<span style="font-weight: bold">):
    </span><span style="color: blue; font-weight: bold">return </span>_arith<span style="font-weight: bold">(</span>mul<span style="font-weight: bold">, </span><span style="color: red">1</span><span style="font-weight: bold">, </span>vals<span style="font-weight: bold">)

</span><span style="color: blue; font-weight: bold">def </span>scm_div<span style="font-weight: bold">(</span>val0<span style="font-weight: bold">, </span>val1<span style="font-weight: bold">):
    </span>_check_nums<span style="font-weight: bold">(</span>val0<span style="font-weight: bold">, </span>val1<span style="font-weight: bold">)
    </span><span style="color: blue; font-weight: bold">return </span>Number<span style="font-weight: bold">(</span>val0<span style="font-weight: bold">.</span>num_val <span style="font-weight: bold">/ </span>val1<span style="font-weight: bold">.</span>num_val<span style="font-weight: bold">)

</span><span style="color: blue; font-weight: bold">def </span>scm_quo<span style="font-weight: bold">(</span>val0<span style="font-weight: bold">, </span>val1<span style="font-weight: bold">):
    </span>_check_nums<span style="font-weight: bold">(</span>val0<span style="font-weight: bold">, </span>val1<span style="font-weight: bold">, </span>pred <span style="font-weight: bold">= </span>scm_integerp<span style="font-weight: bold">)
    </span><span style="color: blue; font-weight: bold">if </span><span style="font-weight: bold">(</span>val0<span style="font-weight: bold">.</span>num_val <span style="font-weight: bold">&lt; </span><span style="color: red">0</span><span style="font-weight: bold">) == (</span>val1<span style="font-weight: bold">.</span>num_val <span style="font-weight: bold">&lt; </span><span style="color: red">0</span><span style="font-weight: bold">):
        </span><span style="color: blue; font-weight: bold">return </span>Number<span style="font-weight: bold">(</span>val0<span style="font-weight: bold">.</span>num_val <span style="font-weight: bold">// </span>val1<span style="font-weight: bold">.</span>num_val<span style="font-weight: bold">)
    </span><span style="color: blue; font-weight: bold">else</span><span style="font-weight: bold">:
        </span><span style="color: blue; font-weight: bold">return </span>Number<span style="font-weight: bold">(-(</span>abs<span style="font-weight: bold">(</span>val0<span style="font-weight: bold">.</span>num_val<span style="font-weight: bold">) // </span>abs<span style="font-weight: bold">(</span>val1<span style="font-weight: bold">.</span>num_val<span style="font-weight: bold">)))

</span><span style="color: blue; font-weight: bold">def </span>scm_modulo<span style="font-weight: bold">(</span>val0<span style="font-weight: bold">, </span>val1<span style="font-weight: bold">):
    </span>_check_nums<span style="font-weight: bold">(</span>val0<span style="font-weight: bold">, </span>val1<span style="font-weight: bold">, </span>pred <span style="font-weight: bold">= </span>scm_integerp<span style="font-weight: bold">)
    </span><span style="color: blue; font-weight: bold">return </span>Number<span style="font-weight: bold">(</span>val0<span style="font-weight: bold">.</span>num_val <span style="font-weight: bold">% </span>val1<span style="font-weight: bold">.</span>num_val<span style="font-weight: bold">)

</span><span style="color: blue; font-weight: bold">def </span>scm_remainder<span style="font-weight: bold">(</span>val0<span style="font-weight: bold">, </span>val1<span style="font-weight: bold">):
    </span>_check_nums<span style="font-weight: bold">(</span>val0<span style="font-weight: bold">, </span>val1<span style="font-weight: bold">, </span>pred <span style="font-weight: bold">= </span>scm_integerp<span style="font-weight: bold">)
    </span>x <span style="font-weight: bold">= </span>val0<span style="font-weight: bold">.</span>num_val
    y <span style="font-weight: bold">= </span>val1<span style="font-weight: bold">.</span>num_val
    <span style="color: blue; font-weight: bold">return </span>Number<span style="font-weight: bold">(</span>x <span style="font-weight: bold">- (</span><span style="color: red">1 </span><span style="color: blue; font-weight: bold">if </span><span style="font-weight: bold">(</span>x<span style="font-weight: bold">&lt;</span><span style="color: red">0</span><span style="font-weight: bold">) == (</span>y<span style="font-weight: bold">&lt;</span><span style="color: red">0</span><span style="font-weight: bold">) </span><span style="color: blue; font-weight: bold">else </span><span style="font-weight: bold">-</span><span style="color: red">1</span><span style="font-weight: bold">) * (</span>abs<span style="font-weight: bold">(</span>x<span style="font-weight: bold">)//</span>abs<span style="font-weight: bold">(</span>y<span style="font-weight: bold">)) * </span>y<span style="font-weight: bold">)

</span><span style="color: blue; font-weight: bold">def </span>scm_floor<span style="font-weight: bold">(</span>val<span style="font-weight: bold">):
    </span>_check_nums<span style="font-weight: bold">(</span>val<span style="font-weight: bold">)
    </span><span style="color: blue; font-weight: bold">return </span>Number<span style="font-weight: bold">(</span>floor<span style="font-weight: bold">(</span>val<span style="font-weight: bold">.</span>num_val<span style="font-weight: bold">))

</span><span style="color: blue; font-weight: bold">def </span>scm_ceil<span style="font-weight: bold">(</span>val<span style="font-weight: bold">):
    </span>_check_nums<span style="font-weight: bold">(</span>val<span style="font-weight: bold">)
    </span><span style="color: blue; font-weight: bold">return </span>Number<span style="font-weight: bold">(</span>floor<span style="font-weight: bold">(</span>val<span style="font-weight: bold">.</span>num_val<span style="font-weight: bold">))

</span><span style="color: blue; font-weight: bold">def </span>_numcomp<span style="font-weight: bold">(</span>op<span style="font-weight: bold">, </span>x<span style="font-weight: bold">, </span>y<span style="font-weight: bold">):
    </span>_check_nums<span style="font-weight: bold">(</span>x<span style="font-weight: bold">, </span>y<span style="font-weight: bold">)
    </span><span style="color: blue; font-weight: bold">return </span>boolify<span style="font-weight: bold">(</span>op<span style="font-weight: bold">(</span>x<span style="font-weight: bold">.</span>num_val<span style="font-weight: bold">, </span>y<span style="font-weight: bold">.</span>num_val<span style="font-weight: bold">))

</span><span style="color: blue; font-weight: bold">def </span>scm_eq<span style="font-weight: bold">(</span>x<span style="font-weight: bold">, </span>y<span style="font-weight: bold">):
    </span><span style="color: blue; font-weight: bold">return </span>_numcomp<span style="font-weight: bold">(</span>eq<span style="font-weight: bold">, </span>x<span style="font-weight: bold">, </span>y<span style="font-weight: bold">)

</span><span style="color: blue; font-weight: bold">def </span>scm_lt<span style="font-weight: bold">(</span>x<span style="font-weight: bold">, </span>y<span style="font-weight: bold">):
    </span><span style="color: blue; font-weight: bold">return </span>_numcomp<span style="font-weight: bold">(</span>lt<span style="font-weight: bold">, </span>x<span style="font-weight: bold">, </span>y<span style="font-weight: bold">)

</span><span style="color: blue; font-weight: bold">def </span>scm_gt<span style="font-weight: bold">(</span>x<span style="font-weight: bold">, </span>y<span style="font-weight: bold">):
    </span><span style="color: blue; font-weight: bold">return </span>_numcomp<span style="font-weight: bold">(</span>gt<span style="font-weight: bold">, </span>x<span style="font-weight: bold">, </span>y<span style="font-weight: bold">)

</span><span style="color: blue; font-weight: bold">def </span>scm_le<span style="font-weight: bold">(</span>x<span style="font-weight: bold">, </span>y<span style="font-weight: bold">):
    </span><span style="color: blue; font-weight: bold">return </span>_numcomp<span style="font-weight: bold">(</span>le<span style="font-weight: bold">, </span>x<span style="font-weight: bold">, </span>y<span style="font-weight: bold">)

</span><span style="color: blue; font-weight: bold">def </span>scm_ge<span style="font-weight: bold">(</span>x<span style="font-weight: bold">, </span>y<span style="font-weight: bold">):
    </span><span style="color: blue; font-weight: bold">return </span>_numcomp<span style="font-weight: bold">(</span>ge<span style="font-weight: bold">, </span>x<span style="font-weight: bold">, </span>y<span style="font-weight: bold">)

</span><span style="color: green; font-style: italic">##
## Other type tests
##

</span><span style="color: blue; font-weight: bold">def </span>scm_atomp<span style="font-weight: bold">(</span>x<span style="font-weight: bold">):
    </span><span style="color: blue; font-weight: bold">return </span>x<span style="font-weight: bold">.</span>atomp<span style="font-weight: bold">()

</span><span style="color: blue; font-weight: bold">def </span>scm_procedurep<span style="font-weight: bold">(</span>x<span style="font-weight: bold">):
    </span><span style="color: blue; font-weight: bold">return </span>x<span style="font-weight: bold">.</span>procedurep<span style="font-weight: bold">()

</span><span style="color: blue; font-weight: bold">def </span>scm_eof_objectp<span style="font-weight: bold">(</span>x<span style="font-weight: bold">):
    </span><span style="color: blue; font-weight: bold">return </span>x<span style="font-weight: bold">.</span>eof_objectp<span style="font-weight: bold">()

</span><span style="color: green; font-style: italic">##
## Output
##

</span><span style="color: blue; font-weight: bold">def </span>scm_display<span style="font-weight: bold">(</span>val<span style="font-weight: bold">):
    </span>val<span style="font-weight: bold">.</span>display<span style="font-weight: bold">(</span>sys<span style="font-weight: bold">.</span>stdout<span style="font-weight: bold">)
    </span><span style="color: blue; font-weight: bold">return </span>UNSPEC

<span style="color: blue; font-weight: bold">def </span>scm_newline<span style="font-weight: bold">():
    </span><span style="color: blue; font-weight: bold">print</span><span style="font-weight: bold">()
    </span>sys<span style="font-weight: bold">.</span>stdout<span style="font-weight: bold">.</span>flush<span style="font-weight: bold">()
    </span><span style="color: blue; font-weight: bold">return </span>UNSPEC

<span style="color: blue; font-weight: bold">def </span>scm_write<span style="font-weight: bold">(</span>val<span style="font-weight: bold">):
    </span>val<span style="font-weight: bold">.</span>write<span style="font-weight: bold">(</span>sys<span style="font-weight: bold">.</span>stdout<span style="font-weight: bold">)
    </span><span style="color: blue; font-weight: bold">return </span>UNSPEC


<span style="color: green; font-style: italic">##
## Other operations
##

</span><span style="color: blue; font-weight: bold">def </span>scm_error<span style="font-weight: bold">(</span>msg <span style="font-weight: bold">= </span><span style="color: blue">None</span><span style="font-weight: bold">):
    </span><span style="color: blue; font-weight: bold">if </span>msg <span style="color: blue; font-weight: bold">is </span><span style="color: blue">None</span><span style="font-weight: bold">:
        </span>msg <span style="font-weight: bold">= </span><span style="color: red">""
    </span><span style="color: blue; font-weight: bold">else</span><span style="font-weight: bold">:
        </span>check_type<span style="font-weight: bold">(</span>msg<span style="font-weight: bold">, </span>scm_symbolp<span style="font-weight: bold">, </span><span style="color: red">0</span><span style="font-weight: bold">, </span><span style="color: red">"error"</span><span style="font-weight: bold">)
        </span>msg <span style="font-weight: bold">= </span>str<span style="font-weight: bold">(</span>msg<span style="font-weight: bold">)
    </span><span style="color: blue; font-weight: bold">raise </span>SchemeError<span style="font-weight: bold">(</span>msg<span style="font-weight: bold">)

</span><span style="color: blue; font-weight: bold">def </span>scm_exit<span style="font-weight: bold">(</span>code <span style="font-weight: bold">= </span><span style="color: blue">None</span><span style="font-weight: bold">):
    </span><span style="color: blue; font-weight: bold">if </span>code <span style="color: blue; font-weight: bold">is </span><span style="color: blue">None</span><span style="font-weight: bold">:
        </span>code <span style="font-weight: bold">= </span><span style="color: red">0
    </span><span style="color: blue; font-weight: bold">else</span><span style="font-weight: bold">:
        </span>check_type<span style="font-weight: bold">(</span>code<span style="font-weight: bold">, </span>scm_integerp<span style="font-weight: bold">, </span><span style="color: red">0</span><span style="font-weight: bold">, </span><span style="color: red">"exit"</span><span style="font-weight: bold">)
        </span>code <span style="font-weight: bold">= </span>code<span style="font-weight: bold">.</span>num_val
    sys<span style="font-weight: bold">.</span>exit<span style="font-weight: bold">(</span>code<span style="font-weight: bold">)

</span><span style="color: green; font-style: italic">##
## Simply Scheme definitions (non-standard)
## 

</span><span style="color: blue; font-weight: bold">def </span>sscm_word<span style="font-weight: bold">(*</span>words<span style="font-weight: bold">):
    </span><span style="color: darkred">"""The atom resulting from concatenating the representations of the atoms
    in WORDS."""
    </span>result <span style="font-weight: bold">= </span><span style="color: red">""
    </span><span style="color: blue; font-weight: bold">for </span>w <span style="color: blue; font-weight: bold">in </span>words<span style="font-weight: bold">:
        </span><span style="color: blue; font-weight: bold">if </span>scm_symbolp<span style="font-weight: bold">(</span>w<span style="font-weight: bold">) </span><span style="color: blue; font-weight: bold">or </span>scm_numberp<span style="font-weight: bold">(</span>w<span style="font-weight: bold">):
            </span>result <span style="font-weight: bold">+= </span>str<span style="font-weight: bold">(</span>w<span style="font-weight: bold">)
        </span><span style="color: blue; font-weight: bold">else</span><span style="font-weight: bold">:
            </span><span style="color: blue; font-weight: bold">raise </span>SchemeError<span style="font-weight: bold">(</span><span style="color: red">"bad argument type to word: {0}"
                              </span><span style="font-weight: bold">.</span>format<span style="font-weight: bold">(</span>w<span style="font-weight: bold">.</span>type_name<span style="font-weight: bold">()))
    </span><span style="color: blue; font-weight: bold">return </span>string_to_atom<span style="font-weight: bold">(</span>result<span style="font-weight: bold">)


</span><span style="color: blue; font-weight: bold">def </span>sscm_first<span style="font-weight: bold">(</span>x<span style="font-weight: bold">):
    </span><span style="color: darkred">"""If X is a list, its car.  If X is an integer of symbol, the Scheme
    value denoted by the first character of its printed representation."""
    </span><span style="color: blue; font-weight: bold">if </span>x<span style="font-weight: bold">.</span>symbolp<span style="font-weight: bold">() </span><span style="color: blue; font-weight: bold">or </span>x<span style="font-weight: bold">.</span>numberp<span style="font-weight: bold">():
        </span><span style="color: blue; font-weight: bold">return </span>string_to_atom<span style="font-weight: bold">(</span>str<span style="font-weight: bold">(</span>x<span style="font-weight: bold">)[</span><span style="color: red">0</span><span style="font-weight: bold">])
    </span><span style="color: blue; font-weight: bold">elif </span>x<span style="font-weight: bold">.</span>pairp<span style="font-weight: bold">():
        </span><span style="color: blue; font-weight: bold">return </span>x<span style="font-weight: bold">.</span>car
    <span style="color: blue; font-weight: bold">else</span><span style="font-weight: bold">:
        </span><span style="color: blue; font-weight: bold">raise </span>SchemeError<span style="font-weight: bold">(</span><span style="color: red">"bad argument to first"</span><span style="font-weight: bold">)

</span><span style="color: blue; font-weight: bold">def </span>sscm_butfirst<span style="font-weight: bold">(</span>x<span style="font-weight: bold">):
    </span><span style="color: darkred">"""If X is a list, its cdr.  If X is a symbol or integer, the Scheme
    value denoted by all but the first character of its printed representation."""
    </span><span style="color: blue; font-weight: bold">if </span>x<span style="font-weight: bold">.</span>pairp<span style="font-weight: bold">():
        </span><span style="color: blue; font-weight: bold">return </span>x<span style="font-weight: bold">.</span>cdr
    <span style="color: blue; font-weight: bold">elif </span>x<span style="font-weight: bold">.</span>symbolp<span style="font-weight: bold">() </span><span style="color: blue; font-weight: bold">or </span>x<span style="font-weight: bold">.</span>numberp<span style="font-weight: bold">():
        </span><span style="color: blue; font-weight: bold">return </span>string_to_atom<span style="font-weight: bold">(</span>str<span style="font-weight: bold">(</span>x<span style="font-weight: bold">)[</span><span style="color: red">1</span><span style="font-weight: bold">:])
    </span><span style="color: blue; font-weight: bold">else</span><span style="font-weight: bold">:
        </span><span style="color: blue; font-weight: bold">raise </span>SchemeError<span style="font-weight: bold">(</span><span style="color: red">"bad argument to butfirst"</span><span style="font-weight: bold">)
    
</span><span style="color: blue; font-weight: bold">def </span>sscm_last<span style="font-weight: bold">(</span>x<span style="font-weight: bold">):
    </span><span style="color: darkred">"""If X is a list, its last element.  If it is a symbol or number, the
    symbol or number denoted by the last character in its string value."""
    </span><span style="color: blue; font-weight: bold">if </span>x<span style="font-weight: bold">.</span>pairp<span style="font-weight: bold">():
        </span><span style="color: blue; font-weight: bold">while </span>x<span style="font-weight: bold">.</span>pairp<span style="font-weight: bold">() </span><span style="color: blue; font-weight: bold">and not </span>x<span style="font-weight: bold">.</span>cdr<span style="font-weight: bold">.</span>nullp<span style="font-weight: bold">():
            </span>x <span style="font-weight: bold">= </span>x<span style="font-weight: bold">.</span>cdr
        <span style="color: blue; font-weight: bold">if </span>x<span style="font-weight: bold">.</span>pairp<span style="font-weight: bold">():
            </span><span style="color: blue; font-weight: bold">return </span>x<span style="font-weight: bold">.</span>car
    <span style="color: blue; font-weight: bold">elif </span>x<span style="font-weight: bold">.</span>symbolp<span style="font-weight: bold">() </span><span style="color: blue; font-weight: bold">or </span>x<span style="font-weight: bold">.</span>numberp<span style="font-weight: bold">():
        </span><span style="color: blue; font-weight: bold">return </span>string_to_atom<span style="font-weight: bold">(</span>str<span style="font-weight: bold">(</span>x<span style="font-weight: bold">)[-</span><span style="color: red">1</span><span style="font-weight: bold">])
    </span><span style="color: blue; font-weight: bold">raise </span>SchemeError<span style="font-weight: bold">(</span><span style="color: red">"bad argument to last"</span><span style="font-weight: bold">)
        
</span><span style="color: blue; font-weight: bold">def </span>sscm_butlast<span style="font-weight: bold">(</span>x<span style="font-weight: bold">):
    </span><span style="color: darkred">"""If X is a list, the list consisting of all but its last element.
    If it is a symbol or number, the symbol or number denoted by all but
    the last character in its string denotation."""
    </span><span style="color: blue; font-weight: bold">if </span>x<span style="font-weight: bold">.</span>pairp<span style="font-weight: bold">():
        </span>result <span style="font-weight: bold">= </span>NULL
        <span style="color: blue; font-weight: bold">while </span>x<span style="font-weight: bold">.</span>pairp<span style="font-weight: bold">() </span><span style="color: blue; font-weight: bold">and not </span>x<span style="font-weight: bold">.</span>cdr<span style="font-weight: bold">.</span>nullp<span style="font-weight: bold">():
            </span><span style="color: blue; font-weight: bold">if </span>result<span style="font-weight: bold">.</span>nullp<span style="font-weight: bold">():
                </span>result <span style="font-weight: bold">= </span>last <span style="font-weight: bold">= </span>scm_cons<span style="font-weight: bold">(</span>x<span style="font-weight: bold">.</span>car<span style="font-weight: bold">, </span>NULL<span style="font-weight: bold">)
            </span><span style="color: blue; font-weight: bold">else</span><span style="font-weight: bold">:
                </span>last<span style="font-weight: bold">.</span>cdr <span style="font-weight: bold">= </span>scm_cons<span style="font-weight: bold">(</span>x<span style="font-weight: bold">.</span>car<span style="font-weight: bold">, </span>NULL<span style="font-weight: bold">)
                </span>last <span style="font-weight: bold">= </span>last<span style="font-weight: bold">.</span>cdr
            x <span style="font-weight: bold">= </span>x<span style="font-weight: bold">.</span>cdr
        <span style="color: blue; font-weight: bold">if </span>x<span style="font-weight: bold">.</span>pairp<span style="font-weight: bold">():
            </span><span style="color: blue; font-weight: bold">return </span>result
    <span style="color: blue; font-weight: bold">elif </span>x<span style="font-weight: bold">.</span>symbolp<span style="font-weight: bold">() </span><span style="color: blue; font-weight: bold">or </span>x<span style="font-weight: bold">.</span>numberp<span style="font-weight: bold">():
        </span><span style="color: blue; font-weight: bold">return </span>string_to_atom<span style="font-weight: bold">(</span>str<span style="font-weight: bold">(</span>x<span style="font-weight: bold">)[</span><span style="color: red">0</span><span style="font-weight: bold">:-</span><span style="color: red">1</span><span style="font-weight: bold">])
    </span><span style="color: blue; font-weight: bold">raise </span>SchemeError<span style="font-weight: bold">(</span><span style="color: red">"bad argument to butlast"</span><span style="font-weight: bold">)

</span><span style="color: blue; font-weight: bold">def </span>sscm_sentence<span style="font-weight: bold">(*</span>vals<span style="font-weight: bold">):
    </span><span style="color: darkred">"""Creates a list out of the integers, symbols, and lists in VALS, treating
    the atoms as single-element lists and concatenating the values together."""
    </span>result <span style="font-weight: bold">= </span>NULL
    <span style="color: blue; font-weight: bold">for </span>i <span style="color: blue; font-weight: bold">in </span>range<span style="font-weight: bold">(</span>len<span style="font-weight: bold">(</span>vals<span style="font-weight: bold">)-</span><span style="color: red">1</span><span style="font-weight: bold">, -</span><span style="color: red">1</span><span style="font-weight: bold">, -</span><span style="color: red">1</span><span style="font-weight: bold">):
        </span>v <span style="font-weight: bold">= </span>vals<span style="font-weight: bold">[</span>i<span style="font-weight: bold">]
        </span><span style="color: blue; font-weight: bold">if </span>scm_listp<span style="font-weight: bold">(</span>v<span style="font-weight: bold">):
            </span>result <span style="font-weight: bold">= </span>scm_append<span style="font-weight: bold">(</span>v<span style="font-weight: bold">, </span>result<span style="font-weight: bold">)
        </span><span style="color: blue; font-weight: bold">elif </span>v<span style="font-weight: bold">.</span>integerp<span style="font-weight: bold">() </span><span style="color: blue; font-weight: bold">or </span>v<span style="font-weight: bold">.</span>symbolp<span style="font-weight: bold">():
            </span>result <span style="font-weight: bold">= </span>scm_cons<span style="font-weight: bold">(</span>v<span style="font-weight: bold">, </span>result<span style="font-weight: bold">)
        </span><span style="color: blue; font-weight: bold">else</span><span style="font-weight: bold">:
            </span><span style="color: blue; font-weight: bold">raise </span>SchemeError<span style="font-weight: bold">(</span><span style="color: red">"bad argument to sentence"</span><span style="font-weight: bold">)
    </span><span style="color: blue; font-weight: bold">return </span>result

<span style="color: green; font-style: italic">##
## Turtle graphics (non-standard)
##

</span>_turtle_screen_on <span style="font-weight: bold">= </span><span style="color: blue; font-weight: bold">False

def </span>_tscm_prep<span style="font-weight: bold">():
    </span><span style="color: blue; font-weight: bold">global </span>_turtle_screen_on
    <span style="color: blue; font-weight: bold">if not </span>_turtle_screen_on<span style="font-weight: bold">:
        </span>_turtle_screen_on <span style="font-weight: bold">= </span><span style="color: blue; font-weight: bold">True
        </span>turtle<span style="font-weight: bold">.</span>title<span style="font-weight: bold">(</span><span style="color: red">"Scheme Turtles"</span><span style="font-weight: bold">)
        </span>turtle<span style="font-weight: bold">.</span>mode<span style="font-weight: bold">(</span><span style="color: red">'logo'</span><span style="font-weight: bold">)

</span><span style="color: blue; font-weight: bold">def </span>tscm_forward<span style="font-weight: bold">(</span>n<span style="font-weight: bold">):
    </span><span style="color: darkred">"""Move the turtle forward a distance N units on the current heading."""
    </span>_check_nums<span style="font-weight: bold">(</span>n<span style="font-weight: bold">)
    </span>_tscm_prep<span style="font-weight: bold">()
    </span>turtle<span style="font-weight: bold">.</span>forward<span style="font-weight: bold">(</span>n<span style="font-weight: bold">.</span>num_val<span style="font-weight: bold">)
    </span><span style="color: blue; font-weight: bold">return </span>UNSPEC

<span style="color: blue; font-weight: bold">def </span>tscm_backward<span style="font-weight: bold">(</span>n<span style="font-weight: bold">):
    </span><span style="color: darkred">"""Move the turtle backward a distance N units on the current heading,
    without changing direction."""
    </span>_check_nums<span style="font-weight: bold">(</span>n<span style="font-weight: bold">)
    </span>_tscm_prep<span style="font-weight: bold">()
    </span>turtle<span style="font-weight: bold">.</span>backward<span style="font-weight: bold">(</span>n<span style="font-weight: bold">.</span>num_val<span style="font-weight: bold">)
    </span><span style="color: blue; font-weight: bold">return </span>UNSPEC

<span style="color: blue; font-weight: bold">def </span>tscm_left<span style="font-weight: bold">(</span>n<span style="font-weight: bold">):
    </span><span style="color: darkred">"""Rotate the turtle's heading N degrees counterclockwise."""
    </span>_check_nums<span style="font-weight: bold">(</span>n<span style="font-weight: bold">)
    </span>_tscm_prep<span style="font-weight: bold">()
    </span>turtle<span style="font-weight: bold">.</span>left<span style="font-weight: bold">(</span>n<span style="font-weight: bold">.</span>num_val<span style="font-weight: bold">)
    </span><span style="color: blue; font-weight: bold">return </span>UNSPEC

<span style="color: blue; font-weight: bold">def </span>tscm_right<span style="font-weight: bold">(</span>n<span style="font-weight: bold">):
    </span><span style="color: darkred">"""Rotate the turtle's heading N degrees clockwise."""
    </span>_check_nums<span style="font-weight: bold">(</span>n<span style="font-weight: bold">)
    </span>_tscm_prep<span style="font-weight: bold">()
    </span>turtle<span style="font-weight: bold">.</span>right<span style="font-weight: bold">(</span>n<span style="font-weight: bold">.</span>num_val<span style="font-weight: bold">)
    </span><span style="color: blue; font-weight: bold">return </span>UNSPEC
    
<span style="color: blue; font-weight: bold">def </span>tscm_circle<span style="font-weight: bold">(</span>r<span style="font-weight: bold">, </span>extent <span style="font-weight: bold">= </span><span style="color: blue">None</span><span style="font-weight: bold">):
    </span><span style="color: darkred">"""Draw a circle with center R units to the left of the turtle (i.e.,
    right if N is negative.  If EXTENT is not None, then draw EXTENT degrees
    of the circle only.  Draws in the clockwise direction if R is negative,
    and otherwise counterclockwise, leaving the turtle facing along the
    arc at its end."""
    </span><span style="color: blue; font-weight: bold">if </span>extent <span style="color: blue; font-weight: bold">is </span><span style="color: blue">None</span><span style="font-weight: bold">:
        </span>_check_nums<span style="font-weight: bold">(</span>r<span style="font-weight: bold">)
    </span><span style="color: blue; font-weight: bold">else</span><span style="font-weight: bold">:
        </span>_check_nums<span style="font-weight: bold">(</span>r<span style="font-weight: bold">, </span>extent<span style="font-weight: bold">)
    </span>_tscm_prep<span style="font-weight: bold">()
    </span>turtle<span style="font-weight: bold">.</span>circle<span style="font-weight: bold">(</span>r<span style="font-weight: bold">.</span>num_val<span style="font-weight: bold">, </span>extent <span style="color: blue; font-weight: bold">and </span>extent<span style="font-weight: bold">.</span>num_val<span style="font-weight: bold">)
    </span><span style="color: blue; font-weight: bold">return </span>UNSPEC
    
<span style="color: blue; font-weight: bold">def </span>tscm_setposition<span style="font-weight: bold">(</span>x<span style="font-weight: bold">, </span>y<span style="font-weight: bold">):
    </span><span style="color: darkred">"""Set turtle's position to (X,Y), heading unchanged."""
    </span>_check_nums<span style="font-weight: bold">(</span>x<span style="font-weight: bold">, </span>y<span style="font-weight: bold">)
    </span>_tscm_prep<span style="font-weight: bold">()
    </span>turtle<span style="font-weight: bold">.</span>setposition<span style="font-weight: bold">(</span>x<span style="font-weight: bold">.</span>num_val<span style="font-weight: bold">, </span>y<span style="font-weight: bold">.</span>num_val<span style="font-weight: bold">)
    </span><span style="color: blue; font-weight: bold">return </span>UNSPEC

<span style="color: blue; font-weight: bold">def </span>tscm_setheading<span style="font-weight: bold">(</span>h<span style="font-weight: bold">):
    </span><span style="color: darkred">"""Set the turtle's heading H degrees clockwise from north (up)."""
    </span>_check_nums<span style="font-weight: bold">(</span>h<span style="font-weight: bold">)
    </span>_tscm_prep<span style="font-weight: bold">()
    </span>turtle<span style="font-weight: bold">.</span>setheading<span style="font-weight: bold">(</span>h<span style="font-weight: bold">.</span>num_val<span style="font-weight: bold">)
    </span><span style="color: blue; font-weight: bold">return </span>UNSPEC

<span style="color: blue; font-weight: bold">def </span>tscm_penup<span style="font-weight: bold">():
    </span><span style="color: darkred">"""Raise the pen, so that the turtle does not draw."""
    </span>_tscm_prep<span style="font-weight: bold">()
    </span>turtle<span style="font-weight: bold">.</span>penup<span style="font-weight: bold">()
    </span><span style="color: blue; font-weight: bold">return </span>UNSPEC

<span style="color: blue; font-weight: bold">def </span>tscm_pendown<span style="font-weight: bold">():
    </span><span style="color: darkred">"""Lower the pen, so that the turtle starts drawing."""
    </span>_tscm_prep<span style="font-weight: bold">()
    </span>turtle<span style="font-weight: bold">.</span>pendown<span style="font-weight: bold">()
    </span><span style="color: blue; font-weight: bold">return </span>UNSPEC

<span style="color: blue; font-weight: bold">def </span>tscm_showturtle<span style="font-weight: bold">():
    </span><span style="color: darkred">"""Make turtle visible."""
    </span>_tscm_prep<span style="font-weight: bold">()
    </span>turtle<span style="font-weight: bold">.</span>showturtle<span style="font-weight: bold">()
    </span><span style="color: blue; font-weight: bold">return </span>UNSPEC

<span style="color: blue; font-weight: bold">def </span>tscm_hideturtle<span style="font-weight: bold">():
    </span><span style="color: darkred">"""Make turtle visible."""
    </span>_tscm_prep<span style="font-weight: bold">()
    </span>turtle<span style="font-weight: bold">.</span>hideturtle<span style="font-weight: bold">()
    </span><span style="color: blue; font-weight: bold">return </span>UNSPEC

<span style="color: blue; font-weight: bold">def </span>tscm_clear<span style="font-weight: bold">():
    </span><span style="color: darkred">"""Clear the drawing, leaving the turtle unchanged."""
    </span>_tscm_prep<span style="font-weight: bold">()
    </span>turtle<span style="font-weight: bold">.</span>clear<span style="font-weight: bold">()
    </span><span style="color: blue; font-weight: bold">return </span>UNSPEC

<span style="color: blue; font-weight: bold">def </span>tscm_color<span style="font-weight: bold">(</span>c<span style="font-weight: bold">):
    </span><span style="color: darkred">"""Set the color to C, a symbol such as red or '#ffc0c0' (representing
    hexadecimal red, green, and blue values."""
    </span>_tscm_prep<span style="font-weight: bold">()
    </span>check_type<span style="font-weight: bold">(</span>c<span style="font-weight: bold">, </span>scm_symbolp<span style="font-weight: bold">, </span><span style="color: red">0</span><span style="font-weight: bold">, </span><span style="color: red">"color"</span><span style="font-weight: bold">)
    </span>turtle<span style="font-weight: bold">.</span>color<span style="font-weight: bold">(</span>str<span style="font-weight: bold">(</span>c<span style="font-weight: bold">))
    </span><span style="color: blue; font-weight: bold">return </span>UNSPEC

<span style="color: blue; font-weight: bold">def </span>tscm_begin_fill<span style="font-weight: bold">():
    </span><span style="color: darkred">"""Start a sequence of moves that outline a shape to be filled."""
    </span>_tscm_prep<span style="font-weight: bold">()
    </span>turtle<span style="font-weight: bold">.</span>begin_fill<span style="font-weight: bold">()
    </span><span style="color: blue; font-weight: bold">return </span>UNSPEC

<span style="color: blue; font-weight: bold">def </span>tscm_end_fill<span style="font-weight: bold">():
    </span><span style="color: darkred">"""Fill in shape drawn since last begin_fill."""
    </span>_tscm_prep<span style="font-weight: bold">()
    </span>turtle<span style="font-weight: bold">.</span>end_fill<span style="font-weight: bold">()
    </span><span style="color: blue; font-weight: bold">return </span>UNSPEC

<span style="color: blue; font-weight: bold">def </span>tscm_exitonclick<span style="font-weight: bold">():
    </span><span style="color: darkred">"""Wait for a click on the turtle window, and then close it."""
    </span><span style="color: blue; font-weight: bold">global </span>_turtle_screen_on
    <span style="color: blue; font-weight: bold">if </span>_turtle_screen_on<span style="font-weight: bold">:
        </span>turtle<span style="font-weight: bold">.</span>exitonclick<span style="font-weight: bold">()
        </span>_turtle_screen_on <span style="font-weight: bold">= </span><span style="color: blue; font-weight: bold">False
    return </span>UNSPEC

<span style="color: blue; font-weight: bold">def </span>tscm_speed<span style="font-weight: bold">(</span>s<span style="font-weight: bold">):
    </span><span style="color: darkred">"""Set the turtle's animation speed as indicated by S (an integer in
    0-10, with 0 indicating no animation (lines draw instantly), and 1-10
    indicating faster and faster movement."""
    </span>check_type<span style="font-weight: bold">(</span>s<span style="font-weight: bold">, </span>scm_integerp<span style="font-weight: bold">, </span><span style="color: red">0</span><span style="font-weight: bold">, </span><span style="color: red">"speed"</span><span style="font-weight: bold">)
    </span>_tscm_prep<span style="font-weight: bold">()
    </span>turtle<span style="font-weight: bold">.</span>speed<span style="font-weight: bold">(</span>s<span style="font-weight: bold">.</span>num_val<span style="font-weight: bold">)
    </span><span style="color: blue; font-weight: bold">return </span>UNSPEC

</pre>
</body>
</html>